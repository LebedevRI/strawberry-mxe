This file is part of MXE. See LICENSE.md for licensing information.

Contains ad hoc patches for cross building.

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jonas Kvinge <jonas@jkvinge.net>
Date: Thu, 4 Mar 2021 21:41:47 +0100
Subject: [PATCH 1/4] Disable examples


diff --git a/examples/meson.build b/examples/meson.build
index 1111111..2222222 100644
--- a/examples/meson.build
+++ b/examples/meson.build
@@ -9,6 +9,6 @@ examples = [
   'simple-proxy'
 ]
 
-foreach example: examples
-  executable(example, example + '.c', dependencies: deps)
-endforeach
+#foreach example: examples
+  #executable(example, example + '.c', dependencies: deps)
+#endforeach

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jonas Kvinge <jonas@jkvinge.net>
Date: Thu, 4 Mar 2021 21:41:59 +0100
Subject: [PATCH 2/4] Use extern


diff --git a/libsoup/soup-version.h.in b/libsoup/soup-version.h.in
index 1111111..2222222 100644
--- a/libsoup/soup-version.h.in
+++ b/libsoup/soup-version.h.in
@@ -32,7 +32,7 @@ G_BEGIN_DECLS
 #  ifdef G_PLATFORM_WIN32
 #    ifdef LIBSOUP_COMPILATION
 #      ifdef DLL_EXPORT
-#        define SOUP_VAR __declspec(dllexport)
+#        define SOUP_VAR extern __declspec(dllexport)
 #      else /* !DLL_EXPORT */
 #        define SOUP_VAR extern
 #      endif /* !DLL_EXPORT */

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jonas Kvinge <jonas@jkvinge.net>
Date: Thu, 4 Mar 2021 21:42:27 +0100
Subject: [PATCH 3/4] Remove cc.run for cross-compilation and ntlm_auth


diff --git a/meson.build b/meson.build
index 1111111..2222222 100644
--- a/meson.build
+++ b/meson.build
@@ -180,8 +180,13 @@ if enable_tls_check
     }
     '''
 
-    rres = cc.run(check_gio_tls_src, name : 'GIO has real TLS support', dependencies : glib_deps)
-    assert(rres.compiled() and rres.returncode() == 0, 'libsoup requires glib-networking for TLS support')
+    if meson.is_cross_build()
+      assert(cc.compiles(check_gio_tls_src, name : 'GIO has real TLS support', dependencies : glib_deps), 'libsoup requires glib-networking for TLS support')
+    else
+      rres = cc.run(check_gio_tls_src, name : 'GIO has real TLS support', dependencies : glib_deps)
+      assert(rres.compiled() and rres.returncode() == 0, 'libsoup requires glib-networking for TLS support')
+    endif
+
   endif
 endif
 
@@ -381,7 +386,6 @@ summary({
 
 summary({
     'GSSAPI' : enable_gssapi,
-    'NTLM' : ntlm_auth.found(),
     'Brotli' : brotlidec_dep.found(),
     'Translations' : xgettext.found(),
     'GIR' : enable_introspection,

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jonas Kvinge <jonas@jkvinge.net>
Date: Thu, 4 Mar 2021 21:43:06 +0100
Subject: [PATCH 4/4] Add missing stdlib.h include


diff --git a/libsoup/soup-date-utils.c b/libsoup/soup-date-utils.c
index 1111111..2222222 100644
--- a/libsoup/soup-date-utils.c
+++ b/libsoup/soup-date-utils.c
@@ -21,6 +21,8 @@
 #include <config.h>
 #endif
 
+#include <stdlib.h>
+
 #include "soup-date-utils.h"
 #include "soup-date-utils-private.h"
 
