This file is part of MXE. See LICENSE.md for licensing information.

Contains ad hoc patches for cross building.

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jonas Kvinge <jonas@jkvinge.net>
Date: Thu, 15 Oct 2020 15:30:51 +0200
Subject: [PATCH 1/1] Add CoInitializeEx() in
 gst_wasapi_util_get_device_enumerator


diff --git a/sys/wasapi/gstwasapiutil.c b/sys/wasapi/gstwasapiutil.c
index 1111111..2222222 100644
--- a/sys/wasapi/gstwasapiutil.c
+++ b/sys/wasapi/gstwasapiutil.c
@@ -311,10 +311,14 @@ gst_wasapi_util_get_device_enumerator (GstObject * self)
   HRESULT hr;
   IMMDeviceEnumerator *enumerator = NULL;
 
+  HRESULT hr_coinit = CoInitializeEx (NULL, COINIT_MULTITHREADED);
+
   hr = CoCreateInstance (&CLSID_MMDeviceEnumerator, NULL, CLSCTX_ALL,
       &IID_IMMDeviceEnumerator, (void **) &enumerator);
   HR_FAILED_RET (hr, CoCreateInstance (MMDeviceEnumerator), NULL);
 
+  if (hr_coinit == S_OK || hr_coinit == S_FALSE) CoUninitialize();
+
   return enumerator;
 }
 
